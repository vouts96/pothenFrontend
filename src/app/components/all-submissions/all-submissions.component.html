<div class="vh-100 d-flex flex-column">
    <!-- Header Section -->
    <app-header></app-header>
  
    <!-- Main Content -->
    <div class="container mb-4 mt-4 flex-grow-1">
      <div class="shadowed-box p-3">
        <h3 class="text-center mb-5">Î›Î¯ÏƒÏ„Î± ÎšÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÏ‰Î½</h3>
  
        <div *ngIf="submissions?.length > 0; else noData">

          <div class="d-flex justify-content-end mb-3">
            <button class="btn btn-outline-secondary" (click)="downloadCSV()">
              ğŸ“„ Î•Î¾Î±Î³Ï‰Î³Î® ÎšÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÏ‰Î½ ÏƒÎµ CSV
            </button>
          </div>
          
          <!-- Table Header -->
          <div class="row font-weight-bold mb-3 d-none d-md-flex">
            <div class="text-center col-1">ID</div>
            <div class="text-center col-2">Î‘.Î¦.Îœ.</div>
            <div class="text-center col-3">ÎŒÎ½Î¿Î¼Î±</div>
            <div class="text-center col-2">Î™Î´Î¹ÏŒÏ„Î·Ï„Î±</div>
            <div class="text-center col-2">Î—Î¼/Î½Î¯Î± Î‘Ï€ÏŒÎºÏ„Î·ÏƒÎ·Ï‚</div>
          </div>
  
          <!-- Submissions Data -->
          <div
            class="row table-row mb-2 align-items-center text-center flex-wrap"
            *ngFor="let submission of submissions"
          >
            <!-- ID -->
            <div class="col-12 col-md-1 text-md-center">
              <strong class="d-md-none">ID:</strong> {{ submission.id }}
            </div>
  
            <!-- Î‘.Î¦.Îœ. -->
            <div class="col-12 col-md-2 text-md-center">
              <strong class="d-md-none">Î‘.Î¦.Îœ.:</strong> {{ submission.afm }}
            </div>
  
            <!-- ÎŒÎ½Î¿Î¼Î± -->
            <div class="col-12 col-md-3 text-md-center">
              <strong class="d-md-none">ÎŒÎ½Î¿Î¼Î±:</strong> {{ submission.firstName }} {{ submission.lastName }}
            </div>
  
            <!-- Î™Î´Î¹ÏŒÏ„Î·Ï„Î± -->
            <div class="col-12 col-md-2 text-md-center">
              <strong class="d-md-none">Î™Î´Î¹ÏŒÏ„Î·Ï„Î±:</strong> {{ submission.position.name }}
            </div>
  
            <!-- Î—Î¼/Î½Î¯Î± Î‘Ï€ÏŒÎºÏ„Î·ÏƒÎ·Ï‚ -->
            <div class="col-12 col-md-2 text-md-center">
              <strong class="d-md-none">Î—Î¼/Î½Î¯Î± Î‘Ï€ÏŒÎºÏ„Î·ÏƒÎ·Ï‚:</strong> {{ submission.acquisitionDate }}
            </div>
  
            <!-- Actions -->
            <div class="col-12 col-md-2 text-center text-md-right mt-2 mt-md-0">
              <button (click)="toggleDetails(submission.id)" class="btn btn-success btn-md">
                Î ÏÎ¿Î²Î¿Î»Î® Î›ÎµÏ€Ï„Î¿Î¼ÎµÏÎµÎ¹ÏÎ½ ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·Ï‚
              </button>
              &nbsp;
              <button (click)="toggleChat(submission.id)" class="btn btn-primary btn-md mt-2 mt-md-0">
                Î¡Ï‰Ï„Î®ÏƒÏ„Îµ Ï„Î¿Î½ Î¨Î·Ï†Î¹Î±ÎºÏŒ Î’Î¿Î·Î¸ÏŒ
              </button>
            </div>

            <!-- Chat Section (Hidden by Default) -->
            <div *ngIf="expandedChatId === submission.id" class="col-12 mt-3 table-row p-3 rounded">
              <app-chat [auditResponse]="audits[submission.id]"></app-chat>
            </div>


            <!-- Dropdown for Submission Details -->
            <div
            *ngIf="expandedSubmissionId === submission.id"
            class="col-12 mt-3 table-row p-3 rounded"
            >
            <table class="table table-borderless">
              <tbody>
                <tr>
                  <th scope="row">Î‘.Î¦.Îœ.</th>
                  <td>{{ submission.afm }}</td>
                </tr>
                <tr>
                  <th scope="row">ÎŒÎ½Î¿Î¼Î±</th>
                  <td>{{ submission.firstName }} {{ submission.lastName }}</td>
                </tr>
                <tr>
                  <th scope="row">Î Î±Ï„ÏÏÎ½Ï…Î¼Î¿</th>
                  <td>{{ submission.fatherName }}</td>
                </tr>
                <tr>
                  <th scope="row">Î™Î´Î¹ÏŒÏ„Î·Ï„Î±</th>
                  <td>{{ submission.position.name }}</td>
                </tr>
                <tr>
                  <th scope="row">Î—Î¼/Î½Î¯Î± Î‘Ï€ÏŒÎºÏ„Î·ÏƒÎ·Ï‚</th>
                  <td>{{ submission.acquisitionDate }}</td>
                </tr>
                <tr>
                  <th scope="row">Î—Î¼/Î½Î¯Î± Î‘Ï€ÏÎ»ÎµÎ¹Î±Ï‚</th>
                  <td>{{ submission.lossDate || 'N/A' }}</td>
                </tr>
                <tr>
                  <th scope="row">ÎŸÏÎ³Î±Î½Î¹ÎºÎ® ÎœÎ¿Î½Î¬Î´Î±</th>
                  <td>{{ submission.organizationUnit }}</td>
                </tr>
                <tr>
                  <th scope="row">ÎÎ­Î± ÎŸÏÎ³Î±Î½Î¹ÎºÎ® ÎœÎ¿Î½Î¬Î´Î±</th>
                  <td>{{ submission.newOrganizationUnit || 'N/A' }}</td>
                </tr>
                <tr>
                  <th scope="row">Î’Î±Î¸Î¼ÏŒÏ‚</th>
                  <td>{{ submission.grade.name }}</td>
                </tr>
                <tr>
                  <th scope="row">ÎŒÎ½Î¿Î¼Î± Î•Ï€Î¹Ï„ÏÎ¿Ï€Î®Ï‚</th>
                  <td>{{ submission.committeeName.name }}</td>
                </tr>
                <tr>
                  <th scope="row">Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î ÏÏ‰Ï„Î¿ÎºÏŒÎ»Î»Î¿Ï…</th>
                  <td>{{ submission.protocolNumber }}</td>
                </tr>
                <tr>
                  <th scope="row">Î—Î¼/Î½Î¯Î± Î‘Ï€ÏŒÏ†Î±ÏƒÎ·Ï‚</th>
                  <td>{{ submission.decisionDate }}</td>
                </tr>
                <tr>
                  <th scope="row">Î ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· Î¥Ï€Î¿Î²Î¿Î»Î®</th>
                  <td>{{ submission.previousSubmission ? 'ÎÎ±Î¹' : 'ÎŒÏ‡Î¹' }}</td>
                </tr>
              </tbody>
            </table>
            </div>

          </div>
        </div>
  
        <!-- No Data Template -->
        <ng-template #noData>
          <p class="text-center text-muted">Î”Îµ Î²ÏÎ­Î¸Î·ÎºÎµ ÎºÎ±Î¼Î¯Î± ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·.</p>
        </ng-template>
      </div>
    </div>
  
    <!-- Footer Section -->
    <app-footer></app-footer>
  </div>
  